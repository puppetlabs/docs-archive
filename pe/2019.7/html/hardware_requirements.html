<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="copyright" content="(C) Copyright 2020"><meta name="DC.rights.owner" content="(C) Copyright 2020"><meta name="DC.type" content="concept"><meta name="description" content="These hardware requirements are based on internal testing at Puppet and are meant only as guidelines to help you determine your hardware needs."><meta name="DC.relation" scheme="URI" content="config_intro.html#config_intro"><meta name="DC.relation" scheme="URI" content="tuning_standard.html#tuning_standard"><meta name="prodname" content="pe"><meta name="version" content="2019.7"><meta name="DC.format" content="HTML5"><meta name="DC.identifier" content="hardware_requirements"><link rel="stylesheet" type="text/css" href="commonltr.css"><title>Hardware requirements</title></head><body><main role="main"><article role="article" aria-labelledby="ariaid-title1"><article class="nested0" aria-labelledby="ariaid-title1" id="hardware_requirements">
    <h1 class="title topictitle1" id="ariaid-title1">Hardware requirements </h1>
    
    <div class="body conbody"><p class="shortdesc">These hardware requirements are based on internal testing
        at <span class="ph">Puppet</span> and are meant only as guidelines to help you
        determine your hardware needs. </p>
        <p dir="ltr" class="p">Your installation's existing code base can significantly
            affect performance, so adjusting expectations based on differences between your
            installation’s code base and the testing code base as documented in <a class="xref" href="hardware_requirements.html#hardware_requirements_test_methods" title="Puppet tests the performance of Puppet Enterprise and develops hardware requirements based on our testing. We continue to invest in improvements in our performance testing methods.">How we develop hardware
                requirements</a> is important to make the best use of the requirements on this
            page. </p>
    </div>
<nav role="navigation" class="related-links"><div class="linklist relinfo"><strong>Related information</strong><br><ul class="linklist"><li class="linklist"><a class="link" href="config_intro.html#config_intro" title="After you've installed Puppet Enterprise (PE), optimize it for your environment by configuring and tuning settings as needed. For example, you might want to add your own certificate to the whitelist, increase the max-threads setting for http and https requests, or configure the number of JRuby instances.">Methods for configuring Puppet Enterprise</a></li><li class="linklist"><a class="link" href="tuning_standard.html#tuning_standard" title="Use these guidelines to configure your installation to maximize its use of available system (CPU and RAM) resources.">Tuning standard installations</a></li></ul></div></nav><article class="topic reference nested1" aria-labelledby="ariaid-title2" id="hardware_requirements_standard">
    <h2 class="title topictitle2" id="ariaid-title2">Hardware requirements for standard installations  </h2>
    
    <div class="body refbody"><p class="shortdesc">In standard installations, hardware requirements differ
        depending on the number of nodes you're managing. To take advantage of progressively larger
        hardware, you must configure your environment to use additional resources.</p>
        <table class="table" id="hardware_requirements_standard__table_arp_243_gjb"><caption></caption><colgroup><col><col><col><col><col><col><col></colgroup><thead class="thead">
                    <tr class="row">
                        <th class="entry" id="hardware_requirements_standard__table_arp_243_gjb__entry__1">Node volume </th>
                        <th class="entry" id="hardware_requirements_standard__table_arp_243_gjb__entry__2">Cores </th>
                        <th class="entry" id="hardware_requirements_standard__table_arp_243_gjb__entry__3">RAM </th>
                        <th class="entry" id="hardware_requirements_standard__table_arp_243_gjb__entry__4">/opt/ </th>
                        <th class="entry" id="hardware_requirements_standard__table_arp_243_gjb__entry__5">/var/</th>
                        <th class="entry" id="hardware_requirements_standard__table_arp_243_gjb__entry__6">AWS EC2</th>
                        <th class="entry" id="hardware_requirements_standard__table_arp_243_gjb__entry__7">Azure</th>
                    </tr>
                </thead><tbody class="tbody">
                    <tr class="row">
                        <td class="entry" headers="hardware_requirements_standard__table_arp_243_gjb__entry__1">Trial use</td>
                        <td class="entry" headers="hardware_requirements_standard__table_arp_243_gjb__entry__2">2</td>
                        <td class="entry" headers="hardware_requirements_standard__table_arp_243_gjb__entry__3">8 GB</td>
                        <td class="entry" headers="hardware_requirements_standard__table_arp_243_gjb__entry__4">20 GB</td>
                        <td class="entry" headers="hardware_requirements_standard__table_arp_243_gjb__entry__5">24 GB</td>
                        <td class="entry" headers="hardware_requirements_standard__table_arp_243_gjb__entry__6">m5.large</td>
                        <td class="entry" headers="hardware_requirements_standard__table_arp_243_gjb__entry__7">A2 v2</td>
                    </tr>
                    <tr class="row">
                        <td class="entry" headers="hardware_requirements_standard__table_arp_243_gjb__entry__1">Up to 2,000</td>
                        <td class="entry" headers="hardware_requirements_standard__table_arp_243_gjb__entry__2">4</td>
                        <td class="entry" headers="hardware_requirements_standard__table_arp_243_gjb__entry__3">8 GB</td>
                        <td class="entry" headers="hardware_requirements_standard__table_arp_243_gjb__entry__4">50 GB</td>
                        <td class="entry" headers="hardware_requirements_standard__table_arp_243_gjb__entry__5">24 GB</td>
                        <td class="entry" headers="hardware_requirements_standard__table_arp_243_gjb__entry__6">c5.xlarge</td>
                        <td class="entry" headers="hardware_requirements_standard__table_arp_243_gjb__entry__7">F4s v2</td>
                    </tr>
                    <tr class="row">
                        <td class="entry" headers="hardware_requirements_standard__table_arp_243_gjb__entry__1">Up to 3,500</td>
                        <td class="entry" headers="hardware_requirements_standard__table_arp_243_gjb__entry__2">8</td>
                        <td class="entry" headers="hardware_requirements_standard__table_arp_243_gjb__entry__3">16 GB</td>
                        <td class="entry" headers="hardware_requirements_standard__table_arp_243_gjb__entry__4">80 GB</td>
                        <td class="entry" headers="hardware_requirements_standard__table_arp_243_gjb__entry__5">24 GB</td>
                        <td class="entry" headers="hardware_requirements_standard__table_arp_243_gjb__entry__6">c5.2xlarge</td>
                        <td class="entry" headers="hardware_requirements_standard__table_arp_243_gjb__entry__7">F8s v2</td>
                    </tr>
                    <tr class="row">
                        <td class="entry" headers="hardware_requirements_standard__table_arp_243_gjb__entry__1">Up to 4,000 </td>
                        <td class="entry" headers="hardware_requirements_standard__table_arp_243_gjb__entry__2">16</td>
                        <td class="entry" headers="hardware_requirements_standard__table_arp_243_gjb__entry__3">32 GB</td>
                        <td class="entry" headers="hardware_requirements_standard__table_arp_243_gjb__entry__4">100 GB</td>
                        <td class="entry" headers="hardware_requirements_standard__table_arp_243_gjb__entry__5">24 GB</td>
                        <td class="entry" headers="hardware_requirements_standard__table_arp_243_gjb__entry__6">c5.4xlarge</td>
                        <td class="entry" headers="hardware_requirements_standard__table_arp_243_gjb__entry__7">F16s v2</td>
                    </tr>
                </tbody></table>
        <section class="section"><div class="p">Important notes on the data in this
                    chart:<ul class="ul">
                    <li class="li"><strong class="ph b">Trial mode:</strong> Although
                        the m5.large instance type is sufficient for trial use, it is not supported.
                        A minimum of four cores is required for production workloads.</li>
                    <li class="li"><strong class="ph b">Azure:</strong> Azure
                        requirements are not currently tested by <span class="ph">Puppet</span>, but are presented here as our best guidance based on comparable EC2
                        instance testing. </li>
                    <li class="li"><strong class="ph b">/opt/ storage
                            requirements:</strong> The database should not exceed 50% of /opt/ to allow
                        for future upgrades.</li>
                    <li class="li"><strong class="ph b">/var/ storage
                            requirements:</strong> There are roughly 20 log files stored in /var/ which
                        are limited in size to 1 GB each. Log retention settings make it unlikely
                        that the maximum capacity will be needed, but we recommend allocating 24 GB
                        to avoid issues.</li>
                </ul></div></section>
    </div>
</article><article class="topic reference nested1" aria-labelledby="ariaid-title3" id="hardware_requirements_large">
    <h2 class="title topictitle2" id="ariaid-title3">Hardware requirements for large installations</h2>
    
    <div class="body refbody"><p class="shortdesc">If you are managing more than 4,000 nodes, you can add
        load-balanced compilers to your installation to increase the number of agents you can
        manage.</p>
        <section class="section"><p class="p">Each compiler increases capacity by
                approximately 1,500–3,000 nodes, until you exhaust the capacity of <span class="ph">PuppetDB</span> or the console, which run on the master. If
                you start to see performance issues around 8,000 nodes, you can adjust your hardware
                or move to a larger base infrastructure.</p><div class="p">
                <div class="note note note_note"><span class="note__title">Note:</span> When you expand your deployment to use
                    compilers, you must also start using load balancers. It is simpler to upgrade
                    your hardware in your installation, if you can, than to add compilers and load
                    balancers.</div>
            </div><div class="p">To manage more than 4,000 nodes, we recommend the following
                minimum hardware:<table class="table"><caption></caption><colgroup><col><col><col><col><col><col><col></colgroup><thead class="thead">
                            <tr class="row">
                                <th class="entry" id="hardware_requirements_large__entry__1">Node volume</th>
                                <th class="entry" id="hardware_requirements_large__entry__2">Node</th>
                                <th class="entry" id="hardware_requirements_large__entry__3">Cores</th>
                                <th class="entry" id="hardware_requirements_large__entry__4">RAM</th>
                                <th class="entry" id="hardware_requirements_large__entry__5">/opt/</th>
                                <th class="entry" id="hardware_requirements_large__entry__6">/var/</th>
                                <th class="entry" id="hardware_requirements_large__entry__7">EC2</th>
                            </tr>
                        </thead><tbody class="tbody">
                            <tr class="row">
                                <td class="entry" headers="hardware_requirements_large__entry__1" rowspan="2">4,000–20,000</td>
                                <td class="entry" headers="hardware_requirements_large__entry__2">Primary node</td>
                                <td class="entry" headers="hardware_requirements_large__entry__3">16</td>
                                <td class="entry" headers="hardware_requirements_large__entry__4">32</td>
                                <td class="entry" headers="hardware_requirements_large__entry__5">150</td>
                                <td class="entry" headers="hardware_requirements_large__entry__6">10</td>
                                <td class="entry" headers="hardware_requirements_large__entry__7">c5.4xlarge</td>
                            </tr>
                            <tr class="row">
                                <td class="entry" headers="hardware_requirements_large__entry__2">Each compiler (1,500 -
                                    3,000 nodes)</td>
                                <td class="entry" headers="hardware_requirements_large__entry__3">4</td>
                                <td class="entry" headers="hardware_requirements_large__entry__4">8</td>
                                <td class="entry" headers="hardware_requirements_large__entry__5">30</td>
                                <td class="entry" headers="hardware_requirements_large__entry__6">2</td>
                                <td class="entry" headers="hardware_requirements_large__entry__7">m5.xlarge</td>
                            </tr>
                        </tbody></table>
            </div></section>
    </div>
</article><article class="topic reference nested1" aria-labelledby="ariaid-title4" id="hardware_requirements_xl">
    <h2 class="title topictitle2" id="ariaid-title4">Hardware requirements for extra-large installations</h2>
    
    
    <div class="body refbody"><p class="shortdesc">You can continue to expand your installation beyond 20,000 nodes by adding compilers
        and increasing the size of your master and PE-PostgreSQL nodes. </p><section class="section"><p class="p">You can also increase the number of nodes you support by tuning certain settings such as
        the run interval (changing how often agents check in) and <code class="ph codeph">report-ttl</code>
        (changing how long <span class="ph">PuppetDB</span> stores reports).</p>
        <div class="p">To manage more than 4,000 nodes, we recommend the following minimum hardware:<table class="table" id="hardware_requirements_xl__table_al1_rlh_5kb"><caption></caption><colgroup><col><col><col><col><col><col><col></colgroup><thead class="thead">
                    <tr class="row">
                        <th class="entry" id="hardware_requirements_xl__table_al1_rlh_5kb__entry__1">Node volume</th>
                        <th class="entry" id="hardware_requirements_xl__table_al1_rlh_5kb__entry__2">Node</th>
                        <th class="entry" id="hardware_requirements_xl__table_al1_rlh_5kb__entry__3">Cores</th>
                        <th class="entry" id="hardware_requirements_xl__table_al1_rlh_5kb__entry__4">RAM</th>
                        <th class="entry" id="hardware_requirements_xl__table_al1_rlh_5kb__entry__5">/opt/</th>
                        <th class="entry" id="hardware_requirements_xl__table_al1_rlh_5kb__entry__6">/var/</th>
                        <th class="entry" id="hardware_requirements_xl__table_al1_rlh_5kb__entry__7">EC2</th>
                    </tr>
                </thead><tbody class="tbody">
                    <tr class="row">
                        <td class="entry" headers="hardware_requirements_xl__table_al1_rlh_5kb__entry__1" rowspan="3">20,000+</td>
                        <td class="entry" headers="hardware_requirements_xl__table_al1_rlh_5kb__entry__2">Primary node</td>
                        <td class="entry" headers="hardware_requirements_xl__table_al1_rlh_5kb__entry__3">16</td>
                        <td class="entry" headers="hardware_requirements_xl__table_al1_rlh_5kb__entry__4">32</td>
                        <td class="entry" headers="hardware_requirements_xl__table_al1_rlh_5kb__entry__5">150</td>
                        <td class="entry" headers="hardware_requirements_xl__table_al1_rlh_5kb__entry__6">10</td>
                        <td class="entry" headers="hardware_requirements_xl__table_al1_rlh_5kb__entry__7">c5.4xlarge</td>
                    </tr>
                    <tr class="row">
                        <td class="entry" headers="hardware_requirements_xl__table_al1_rlh_5kb__entry__2">Each compiler (1,500 - 3,000 nodes)</td>
                        <td class="entry" headers="hardware_requirements_xl__table_al1_rlh_5kb__entry__3">4</td>
                        <td class="entry" headers="hardware_requirements_xl__table_al1_rlh_5kb__entry__4">8</td>
                        <td class="entry" headers="hardware_requirements_xl__table_al1_rlh_5kb__entry__5">30</td>
                        <td class="entry" headers="hardware_requirements_xl__table_al1_rlh_5kb__entry__6">2</td>
                        <td class="entry" headers="hardware_requirements_xl__table_al1_rlh_5kb__entry__7">m5.xlarge</td>
                    </tr>
                    <tr class="row">
                        <td class="entry" headers="hardware_requirements_xl__table_al1_rlh_5kb__entry__2">PE-PostgreSQL node</td>
                        <td class="entry" headers="hardware_requirements_xl__table_al1_rlh_5kb__entry__3">16</td>
                        <td class="entry" headers="hardware_requirements_xl__table_al1_rlh_5kb__entry__4">128</td>
                        <td class="entry" headers="hardware_requirements_xl__table_al1_rlh_5kb__entry__5">300</td>
                        <td class="entry" headers="hardware_requirements_xl__table_al1_rlh_5kb__entry__6">4</td>
                        <td class="entry" headers="hardware_requirements_xl__table_al1_rlh_5kb__entry__7">r5.4xlarge</td>
                    </tr>
                </tbody></table></div>
        <p class="p">If you manage more than 20,000 nodes, contact <span class="ph">Puppet</span>
            professional services to talk about optimizing your setup for your specific
            requirements</p></section></div>
</article><article class="topic concept nested1" aria-labelledby="ariaid-title5" id="hardware_requirements_test_methods">
 <h2 class="title topictitle2" id="ariaid-title5">How we develop hardware requirements: Performance test
  methods</h2>
 

 

 <div class="body conbody"><p class="shortdesc"><span class="ph">Puppet</span> tests the performance
  of <span class="ph">Puppet Enterprise</span> and develops hardware requirements based on our testing.
  We continue to invest in improvements in our performance testing methods. </p>
  <p class="p">The performance of <span class="ph">Puppet Enterprise</span> is highly
   dependent on the code base used by a specific installation. The details included here are
   intended to help you evaluate how your specific installation compares to what we used to generate
   our scale and hardware estimates so that you can better estimate what you need to manage your <span class="ph">Puppet</span> infrastructure. </p>
  <section class="section"><h3 class="title sectiontitle">Tools: Gatling and <code class="ph codeph">puppet infrastructure tune</code></h3>
   
   <p dir="ltr" class="p">We use <a class="xref" href="https://github.com/puppetlabs/gatling-puppet-load-test" target="_blank">gatling-puppet-load-test</a>, a framework we’ve developed to perform load and performance
    testing for <span class="ph">PE</span> and open source <span class="ph">Puppet</span>. It uses <a class="xref" href="https://gatling.io/" target="_blank">Gatling</a>, an open source load and performance
    testing tool that records and replays HTTP traffic, then generates reports about the performance
    of the simulated requests. Using Gatling allows us to simulate agent requests in a full <span class="ph">PE</span> installation where <span class="ph">Puppet Server</span> is
    driving communication with <span class="ph">PuppetDB</span>, the node classifier, and
    other tools. </p>
   <p class="p">We also use <code class="ph codeph">puppet
     infrastructure tune</code>, which provides configuration settings to apply to the
    installation.</p>
  </section>
  <section class="section"><h3 class="title sectiontitle">Platform: <span class="ph">Amazon</span> EC2</h3>
   
   <div class="p" dir="ltr">We use <span class="ph">Amazon</span> EC2 instances for
    our performance tests with a master node running PE and a metrics node running the simulated
    agents and capturing the performance data. We know that the instances' performance varies, but
    this has less of an impact on overall performance than the variations in the size and complexity
    of users' code bases.<table class="table frame-all"><caption><span class="table--title-label">Table 1. </span><span class="title">EC2 instance types</span></caption><colgroup><col style="width:25%"><col style="width:25%"><col style="width:25%"><col style="width:25%"></colgroup><thead class="thead">
       <tr class="row">
        <th class="entry align-left" id="hardware_requirements_test_methods__entry__1">AWS EC2</th>
        <th class="entry align-left" id="hardware_requirements_test_methods__entry__2">Cores</th>
        <th class="entry align-left" id="hardware_requirements_test_methods__entry__3">RAM</th>
        <th class="entry align-left" id="hardware_requirements_test_methods__entry__4">Testing use</th>
       </tr>
      </thead><tbody class="tbody">
       <tr class="row">
        <td class="entry align-left" headers="hardware_requirements_test_methods__entry__1">m5.large</td>
        <td class="entry align-left" headers="hardware_requirements_test_methods__entry__2">2</td>
        <td class="entry align-left" headers="hardware_requirements_test_methods__entry__3">8 GB</td>
        <td class="entry align-left" headers="hardware_requirements_test_methods__entry__4">Confirming trial size works</td>
       </tr>
       <tr class="row">
        <td class="entry align-left" headers="hardware_requirements_test_methods__entry__1">c5.xlarge</td>
        <td class="entry align-left" headers="hardware_requirements_test_methods__entry__2">4</td>
        <td class="entry align-left" headers="hardware_requirements_test_methods__entry__3">8 GB</td>
        <td class="entry align-left" headers="hardware_requirements_test_methods__entry__4">Scale</td>
       </tr>
       <tr class="row">
        <td class="entry align-left" headers="hardware_requirements_test_methods__entry__1">c5.2xlarge</td>
        <td class="entry align-left" headers="hardware_requirements_test_methods__entry__2">8</td>
        <td class="entry align-left" headers="hardware_requirements_test_methods__entry__3">16 GB</td>
        <td class="entry align-left" headers="hardware_requirements_test_methods__entry__4">Scale, Apples-to-apples, Soak</td>
       </tr>
       <tr class="row">
        <td class="entry align-left" headers="hardware_requirements_test_methods__entry__1">c5.4xlarge</td>
        <td class="entry align-left" headers="hardware_requirements_test_methods__entry__2">16</td>
        <td class="entry align-left" headers="hardware_requirements_test_methods__entry__3">32 GB</td>
        <td class="entry align-left" headers="hardware_requirements_test_methods__entry__4">Scale</td>
       </tr>
      </tbody></table></div>
  </section>
  <section class="section"><h3 class="title sectiontitle">Test environment</h3>
   
   <p class="p"><strong class="ph b">Control repository</strong></p>
   <p dir="ltr" class="p">We use <a class="xref" href="https://github.com/puppetlabs/puppetlabs-pe_perf_control_repo" target="_blank"><u class="ph u">puppetlabs-pe_perf_control_repo</u></a> with <span class="ph">r10k</span> to classify the simulated agents using roles and profiles, with
    three sizes defined.</p>
   <p class="p"><strong class="ph b">Facts and reports</strong></p>
   <div class="p" dir="ltr">Although the simulated agents all share the same classification,
    we use dynamic facts and varying report responses (no change, failure, intentional change,
    corrective change) to better simulate a typical customer environment.<table class="table frame-all"><caption></caption><colgroup><col style="width:25%"><col style="width:25%"><col style="width:25%"><col style="width:25%"></colgroup><tbody class="tbody">
       <tr class="row">
        <td class="entry align-left"></td>
        <td class="entry align-left"><strong class="ph b">role::by_size::small</strong></td>
        <td class="entry align-left"><strong class="ph b">role::by_size::medium</strong></td>
        <td class="entry align-left"><strong class="ph b">role::by_size::large</strong></td>
       </tr>
       <tr class="row">
        <td class="entry align-left"><strong class="ph b">Resources</strong></td>
        <td class="entry align-left">129</td>
        <td class="entry align-left">750</td>
        <td class="entry align-left">1267</td>
       </tr>
       <tr class="row">
        <td class="entry align-left"><strong class="ph b">Classes</strong></td>
        <td class="entry align-left">24</td>
        <td class="entry align-left">71</td>
        <td class="entry align-left">120</td>
       </tr>
       <tr class="row">
        <td class="entry align-left"><strong class="ph b">Facts</strong></td>
        <td class="entry align-left">151</td>
        <td class="entry align-left">151</td>
        <td class="entry align-left">151</td>
       </tr>
      </tbody></table></div>
   <p class="p"><strong class="ph b">Classification</strong></p>
   <div class="p">
    <pre class="pre codeblock"><code>class role::by_size::small {
  include ::profile::tomcat::basic
  include ::profile::postgresql::basic
}

class role::by_size::medium {
  include ::role::by_size::small

  include ::profile::users
  include ::profile::sysop::packages
  include ::profile::motd
  include ::profile::hiera_check
}

class role::by_size::large {
  include ::role::by_size::medium

  include ::profile::apache::basic
  include ::profile::influxdb::basic
  include ::profile::loop_through_file_resources
}</code></pre>
   </div>
   <p class="p"><strong class="ph b">Environment cache</strong></p>
   <p class="p">Although we recommend <a class="xref" href="https://puppet.com/docs/puppet/latest/configuration.html#environmenttimeout" target="_blank"><u class="ph u">enabling environment caching</u></a> to
    improve performance in production environments, we do not enable it in our performance testing
    environment to avoid unrealistic results due to the identical classification of the simulated
    agents.</p>
  </section>
  <section class="section">
   <p class="p"><strong class="ph b">Fact, resource, and class counts</strong></p>
   <p class="p">You can query <span class="ph">PuppetDB</span> using <span class="ph">Puppet Query Language
                                                  (PQL)</span> to find the number of facts, resources, and classes
    for a given node. </p>
   <div class="p">First, you will need a token with permissions to query Puppet DB. If you
    don't already have one, you can generate one using <code class="ph codeph">puppet-access</code> on the master. For example:
    <pre class="pre codeblock"><code>puppet access login -l 1d</code></pre></div>
  </section>
  <section class="section">
   <p class="p">See our <a class="xref" href="rbac_token_auth_intro.html#token_based_authentication" title="Authentication tokens allow a user to enter their credentials once, then receive an alphanumeric &#34;token&#34; to use to access different services or parts of the system infrastructure. Authentication tokens are tied to the permissions granted to the user through RBAC, and provide the user with the appropriate access to HTTP requests.">Token-based authentication</a>
    docs for more information on generating tokens. </p>
   <div class="p">Once you have a valid token, determine the number of facts, resources, and
    classes for the specified node using the example code below. In the examples, we used <code class="ph codeph">perf-agent1</code> as the node
    name.<pre class="pre codeblock"><code>puppet query "facts[count()] {certname = 'perf-agent1'}"</code></pre><pre class="pre codeblock"><code>puppet query "resources[count()] {certname = 'perf-agent1'}"</code></pre><pre class="pre codeblock"><code>puppet query "resources[count()] {type = 'Class' and certname = 'perf-agent1'}"</code></pre></div>
  </section>
  <section class="section">
   <p class="p">For background and additional examples, check out this <a class="xref" href="https://puppet.com/blog/getting-know-puppet-query-language-pql" target="_blank">blog
     post</a> or view the full <a class="xref" href="https://puppet.com/docs/puppetdb/latest/api/query/v4/pql.html" target="_blank">PQL
     documentation</a>.</p>
  </section>
  <section class="section"><h3 class="title sectiontitle">Testing methodology</h3>
   
   <p class="p"><strong class="ph b">Warming up <span class="ph">Puppet Server</span></strong></p>
   <p dir="ltr" class="p"><span class="ph">JRuby</span> 9000 provides better overall
    performance than the previous version, but it also comes with a warm-up burden. For some tests
    we want the <span class="ph">Puppet Server</span> process to be warmed up before we begin. Our
    warm-up process involves running a portion of the agents to generate about 300 connections to
    the endpoints served by JRubies, multiplied by the number of configured <span class="ph">JRuby</span> instances. In general, the closer you are to the node capacity
    of your install, the faster it will warm up when running the normal load. Our process takes
    about five minutes. </p>
   <p class="p"><strong class="ph b">Apples-to-apples testing</strong></p>
   <p dir="ltr" class="p">To do an apples-to-apples test, we run a simulation for two
    different <span class="ph">PE</span> versions of 600 agents each (classified as large)
    checking in at the default 30-minute interval for eight iterations. We run the warm-up procedure
    before the simulation. Then we compare response times, system resource usage, and process
    resource usage. We do this on a weekly basis for all active development branches to ensure that
    general performance doesn’t degrade during development.</p>
   <p class="p"><strong class="ph b">Scale testing</strong></p>
   <p dir="ltr" class="p">In order to determine the node capacity of each targeted EC2
    instance type, we perform scale testing with a small load that incrementally increases the
    number of simulated agents until requests begin to time out or respond with errors. </p>
   <p dir="ltr" class="p">The scale test is structured to simulate the default 30-minute
    agent check-in interval. We start the test with an agent volume below the expected performance
    threshold and add 100 agents at a time until more than 10 timeouts are encountered. For example,
    when testing the EC2 c5.2xlarge (8 cores and 16 GB), we start with 3,000 agents.</p>
   <p class="p"><strong class="ph b">Cold-start versus warm-start scale
     testing</strong></p>
   <p dir="ltr" class="p">To simulate recovering from a <span class="ph">Puppet Server</span> restart, we use a cold-start scenario. We restart the
     <code class="ph codeph">pe-puppetserver</code> service between
    each iteration so that the warm-up burden will reduce the maximum node count. This is the most
    conservative estimate of node capacity we test for. </p>
   <p dir="ltr" class="p">To determine burst capacity, we use a warm-start scenario. When
    doing a warm-start scale test, we don’t restart the <code class="ph codeph">pe-puppetserver</code> service, and we run the test on the same host that ran
    the cold-start tests to ensure it is already warmed up.</p>
   <p dir="ltr" class="p">The extra capacity provided by a warmed up system is great for
    serving <span class="ph">Puppet</span> agent runs triggered by orchestration from the
    console, <span class="ph">Continuous Delivery for Puppet
                                                  Enterprise</span>, or <span class="ph">Bolt</span>.
    Therefore we recommend keeping your node count near the cold-start numbers.</p>
   <p class="p"><strong class="ph b">Soak testing</strong></p>
   <p dir="ltr" class="p">To ensure <span class="ph">PE</span> doesn’t suffer a
    performance degradation over time we run a soak test on each release. We use 600 agents,
    classified as large, checking in at the default 30-minute interval for 14 days. We run the
    warm-up before we start the test. This two-week test lets us verify that all garbage collection
    features are being triggered and keeping things under control. We check the Gatling response
    time graphs to ensure that performance is stable throughout the test.</p>
   <p dir="ltr" class="p"> </p>
  </section>
 </div>
</article></article></article></main></body></html>